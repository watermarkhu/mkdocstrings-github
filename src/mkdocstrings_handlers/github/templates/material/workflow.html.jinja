{#- Template for GitHub Action reusable workflow.

Context:
  data (mkdocstrings_handlers.github.objects.Workflow): The workflow to render.
  config (mkdocstrings_handlers.github.config.GitHubConfig): The global configuration
  options (dict): The local options
-#}

{% block logs scoped %}
  {#- Logging block.

  This block can be used to log debug messages, deprecation messages, warnings, etc.
  -#}
  {{ log.debug("Rendering " + data.id) }}
{% endblock logs %}

{% if options.show_branding %}
  <script src="{{ config.feather_icons_source }}"></script>
{% endif %}
<div class="doc doc-object doc-workflow">
  {% include "heading.html.jinja" with context %}

  {% set signature = data.id | format_action_signature(options.signature_repository if options.signature_repository else repository_name, options) %}

  {% block signature scoped %}
    {% if options.show_signature %}
      {% with inputs = data.inputs | order_parameters(options.parameters_order) | filter_parameters(required=True), secrets = data.secrets | order_parameters(options.parameters_order) | filter_parameters(required=True) %}
        <div class="annotate">
        {% filter highlight(language="yaml", inline=False, linenums=False) %}
          uses: {{ signature }}
          {% if options.signature_show_permissions and data.permissions|length > 0 %}
          {% if data.permission_read_all %}
          permissions: read-all
          {% elif data.permission_write_all %}
          permissions: write-all
          {% else %}
          permissions:
            {% for scope, level in data.permissions | items %}
            {{ scope }}: {{ level.label }}
            {% endfor %}
          {% endif %}
          {% endif %}
          {% if inputs|length > 0 %}
          with:
            {% for input in inputs %}
            {{ input.name }}: ({{ loop.index }})
            {% endfor %}
          {% endif %}
          {% if options.signature_show_secrets %}
          {% if secrets|length > 0 %}
          secrets:
            {% for secret in secrets %}
            {{ secret.name }}: ({{ inputs|length + loop.index }})
            {% endfor %}
          {% endif %}
          {% endif %}
        {% endfilter %}
        </div>
        <ol>
        {% for input in inputs %}
          <li>{{ input.description | convert_markdown(options.heading_level) if input.description else "(no description)" }}</li>
        {% endfor %}
        {% for secret in secrets %}
          <li>{{ secret.description | convert_markdown(options.heading_level) if secret.description else "(no description)" }}</li>
        {% endfor %}
        </ol>
      {% endwith %}
    {% endif %}
  {% endblock signature %}

  {% block description scoped %}
    {% if options.show_description %}
      {{ options.description if options.description else data.description | convert_markdown(options.heading_level, data.id) }}
    {% endif %}
  {% endblock description %}

  {% block flowchart scoped %}
    {% if options.workflow_flow_chart %}
      {% set flowchart = data | generate_mermaid_flowchart %}
      {% if flowchart %}
        <pre class="mermaid"><code>
        {{ flowchart }}
        </code></pre>
      {% endif %}
    {% endif %}
  {% endblock flowchart %}

  {% block inputs scoped %}
    {% if options.show_inputs %}
      {% with inputs = data.inputs | order_parameters(options.parameters_order) | filter_parameters(required=options.show_inputs_only_required) %}
        {% include "inputs.html.jinja" with context %}
      {% endwith %}
    {% endif %}
  {% endblock inputs %}

  {% block secrets scoped %}
    {% if options.show_secrets %}
      {% with secrets = data.secrets | order_parameters(options.parameters_order) | filter_parameters(required=options.show_secrets_only_required) %}
        {% include "secrets.html.jinja" with context %}
      {% endwith %}
    {% endif %}
  {% endblock secrets %}

  {% block outputs scoped %}
    {% if options.show_outputs %}
      {% with outputs = data.outputs | order_parameters(options.parameters_order) %}
        {% include "outputs.html.jinja" with context %}
      {% endwith %}
    {% endif %}
  {% endblock outputs %}

  {% block source scoped %}
    {% if options.show_source %}
      <details class="quote">
        <summary>Source of <code>{{ signature }}</code></summary>
        {{ data.source|highlight(language="yaml", linenums=True) }}
      </details>
    {% endif %}
  {% endblock %}
</div>
{% if options.show_branding %}
  <script>feather.replace()</script>
{% endif %}
